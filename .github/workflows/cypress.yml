name: E2E on Chrome
on: [push]
jobs:
  cypress-run:
    runs-on: ubuntu-20.04
    # let's make sure our tests pass on Chrome browser
    name: E2E on Chrome
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup npm package
        run: |
          # npm i -g npx
          npm install
          # npx cypress verify
          # npx cypress info
          # npx cypress --version

      - name: Run tests 
        run: npx cypress run --browser chrome --spec cypress/e2e/automationPractice/tests/**.js

      - name: Uploading artifact
        uses: actions/upload-artifact@v2
        if: always()
        with:
          name: cypress-execution-report
          path: cypress/reports/html
          retention-days: 30
          
      - name: Telegram notification about successful build
        run: |
          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendPhoto" \
          -F chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
          -F photo=@build_success.png \
          -F caption="
          âœ”ï¸GIT: Build number ${{ github.run_number }} 
          SUCCESS ğŸ˜
          ğŸŒ³BRANCH: ${{ github.ref }}
          ğŸ“‚REPO: ${{ github.repository }}
          ğŸ‘‘OWNER: ${{ github.repository_owner }}
          
          ğŸ“COMMIT MESSAGE: ${{ github.event.head_commit.message }}ğŸš€"
        if: success()

      - name: Telegram notification about failed build
        run: |
          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendPhoto" \
          -F chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
          -F photo=@build_failed.png \
          -F caption="
          âŒGIT: Build number ${{ github.run_number }}
          FAILED ğŸ˜­
          ğŸŒ³BRANCH: ${{ github.ref }}
          ğŸ“‚REPO: ${{ github.repository }}
          ğŸ‘‘OWNER: ${{ github.repository_owner }}
          
          ğŸ“COMMIT MESSAGE: ${{ github.event.head_commit.message }}ğŸš€"
        if: failure()
